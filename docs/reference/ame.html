<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>AME model fitting routine — ame • lame</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="AME model fitting routine — ame"><meta name="description" content="An MCMC routine providing a fit to an additive and multiplicative effects
(AME) regression model to relational data of various types"><meta property="og:description" content="An MCMC routine providing a fit to an additive and multiplicative effects
(AME) regression model to relational data of various types"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">lame</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.10</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/netify-dev/lame" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>AME model fitting routine</h1>
      <small class="dont-index">Source: <a href="https://github.com/netify-dev/lame/blob/HEAD/R/ame.R" class="external-link"><code>R/ame.R</code></a></small>
      <div class="d-none name"><code>ame.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>An MCMC routine providing a fit to an additive and multiplicative effects
(AME) regression model to relational data of various types</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ame</span><span class="op">(</span><span class="va">Y</span>, Xdyad<span class="op">=</span><span class="cn">NULL</span>, Xrow<span class="op">=</span><span class="cn">NULL</span>, Xcol<span class="op">=</span><span class="cn">NULL</span>, rvar <span class="op">=</span> <span class="op">!</span><span class="op">(</span><span class="va">family</span><span class="op">==</span><span class="st">"rrl"</span><span class="op">)</span> ,</span>
<span>cvar <span class="op">=</span> <span class="cn">TRUE</span>,  dcor <span class="op">=</span> <span class="op">!</span><span class="va">symmetric</span>, nvar<span class="op">=</span><span class="cn">TRUE</span>, R <span class="op">=</span> <span class="fl">0</span>, family<span class="op">=</span><span class="st">"normal"</span>,</span>
<span>intercept<span class="op">=</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">family</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rrl"</span>,<span class="st">"ordinal"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>symmetric<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>odmax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">Y</span><span class="op">&gt;</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="va">sum</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span>, </span>
<span>prior<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, g<span class="op">=</span><span class="cn">NA</span>,</span>
<span>seed <span class="op">=</span> <span class="fl">6886</span>, nscan <span class="op">=</span> <span class="fl">10000</span>, burn <span class="op">=</span> <span class="fl">500</span>, odens <span class="op">=</span> <span class="fl">25</span>, </span>
<span>plot<span class="op">=</span><span class="cn">TRUE</span>, print <span class="op">=</span> <span class="cn">TRUE</span>, gof<span class="op">=</span><span class="cn">TRUE</span>, model.name<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-y">Y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>an n x n square relational matrix of relations. See family below for
various data types.</p></dd>


<dt id="arg-xdyad">Xdyad<a class="anchor" aria-label="anchor" href="#arg-xdyad"></a></dt>
<dd><p>an n x n x pd array of covariates</p></dd>


<dt id="arg-xrow">Xrow<a class="anchor" aria-label="anchor" href="#arg-xrow"></a></dt>
<dd><p>an n x pr matrix of nodal row covariates</p></dd>


<dt id="arg-xcol">Xcol<a class="anchor" aria-label="anchor" href="#arg-xcol"></a></dt>
<dd><p>an n x pc matrix of nodal column covariates</p></dd>


<dt id="arg-rvar">rvar<a class="anchor" aria-label="anchor" href="#arg-rvar"></a></dt>
<dd><p>logical: fit row random effects (asymmetric case)?</p></dd>


<dt id="arg-cvar">cvar<a class="anchor" aria-label="anchor" href="#arg-cvar"></a></dt>
<dd><p>logical: fit column random effects (asymmetric case)?</p></dd>


<dt id="arg-dcor">dcor<a class="anchor" aria-label="anchor" href="#arg-dcor"></a></dt>
<dd><p>logical: fit a dyadic correlation (asymmetric case)?</p></dd>


<dt id="arg-nvar">nvar<a class="anchor" aria-label="anchor" href="#arg-nvar"></a></dt>
<dd><p>logical: fit nodal random effects (symmetric case)?</p></dd>


<dt id="arg-r">R<a class="anchor" aria-label="anchor" href="#arg-r"></a></dt>
<dd><p>integer: dimension of the multiplicative effects (can be zero)</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>character: one of "normal","tobit","binary","ordinal","cbin","frn","rrl","poisson" - see
the details below</p></dd>


<dt id="arg-intercept">intercept<a class="anchor" aria-label="anchor" href="#arg-intercept"></a></dt>
<dd><p>logical: fit model with an intercept?</p></dd>


<dt id="arg-symmetric">symmetric<a class="anchor" aria-label="anchor" href="#arg-symmetric"></a></dt>
<dd><p>logical: Is the sociomatrix symmetric by design?</p></dd>


<dt id="arg-odmax">odmax<a class="anchor" aria-label="anchor" href="#arg-odmax"></a></dt>
<dd><p>a scalar integer or vector of length n giving the maximum
number of nominations that each node may make - used for "frn" and "cbin"
families</p></dd>


<dt id="arg-prior">prior<a class="anchor" aria-label="anchor" href="#arg-prior"></a></dt>
<dd><p>a list containing hyperparameters for the prior distributions.
Available options and their defaults:</p><dl><dt>Sab0</dt>
<dd><p>Prior covariance matrix for additive effects (default: diag(2)).
A 2x2 matrix where Sab0\[1,1\] is the prior variance for row effects,
Sab0\[2,2\] is the prior variance for column effects, and off-diagonals
control correlation between row and column effects.</p></dd>

<dt>eta0</dt>
<dd><p>Prior degrees of freedom for covariance of multiplicative effects
(default: 4 + 3 \* n/100, where n is the number of actors). Higher values
impose stronger shrinkage on the latent factors. Common values: 4-10 for
weak shrinkage, 10-20 for moderate, &gt;20 for strong shrinkage.</p></dd>

<dt>etaab</dt>
<dd><p>Prior degrees of freedom for covariance of additive effects
(default: 4 + 3 \* n/100). Controls shrinkage of row/column random effects.
Larger values shrink effects toward zero.</p></dd>

<dt>s20</dt>
<dd><p>Prior variance for regression coefficients (default: 1).
Larger values allow for larger coefficient values.</p></dd>

<dt>s2u0</dt>
<dd><p>Prior variance for multiplicative effects (default: 1).</p></dd>

<dt>Suv0</dt>
<dd><p>Prior covariance for multiplicative effects (default: identity matrix).</p></dd>


</dl><p>Common usage: prior = list(Sab0 = diag(c(2, 2)), eta0 = 10) for moderate
shrinkage, or prior = list(Sab0 = diag(c(0.5, 0.5))) for tighter control.</p></dd>


<dt id="arg-g">g<a class="anchor" aria-label="anchor" href="#arg-g"></a></dt>
<dd><p>optional scalar or vector of length dim(X)\[3\] for g-prior on
regression coefficients. If not specified, defaults are: for normal family,
g = n<em>var(Y); for tobit, g = n</em>var(Y)*4; for other families, g = n, where
n is the number of non-missing dyads. The g-prior controls the variance of
regression coefficients.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>random seed</p></dd>


<dt id="arg-nscan">nscan<a class="anchor" aria-label="anchor" href="#arg-nscan"></a></dt>
<dd><p>number of iterations of the Markov chain (beyond burn-in)</p></dd>


<dt id="arg-burn">burn<a class="anchor" aria-label="anchor" href="#arg-burn"></a></dt>
<dd><p>burn in for the Markov chain</p></dd>


<dt id="arg-odens">odens<a class="anchor" aria-label="anchor" href="#arg-odens"></a></dt>
<dd><p>output density for the Markov chain</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>logical: plot results while running?</p></dd>


<dt id="arg-print">print<a class="anchor" aria-label="anchor" href="#arg-print"></a></dt>
<dd><p>logical: print results while running?</p></dd>


<dt id="arg-gof">gof<a class="anchor" aria-label="anchor" href="#arg-gof"></a></dt>
<dd><p>logical: calculate goodness of fit statistics?</p></dd>


<dt id="arg-model-name">model.name<a class="anchor" aria-label="anchor" href="#arg-model-name"></a></dt>
<dd><p>optional string for model selection output</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>


<dl><dt>BETA</dt>
<dd><p>posterior samples of regression coefficients</p></dd>

<dt>VC</dt>
<dd><p>posterior samples of the variance parameters</p></dd>

<dt>APM</dt>
<dd><p>posterior mean of additive row effects a</p></dd>
 <dt>BPM</dt>
<dd><p>posterior
mean of additive column effects b</p></dd>
 <dt>U</dt>
<dd><p>posterior mean of multiplicative
row effects u</p></dd>
 <dt>V</dt>
<dd><p>posterior mean of multiplicative column effects v (asymmetric case)</p></dd>

<dt>UVPM</dt>
<dd><p>posterior mean of UV (asymmetric case)</p></dd>

<dt>ULUPM</dt>
<dd><p>posterior mean of ULU (symmetric case)</p></dd>

<dt>L</dt>
<dd><p>posterior mean of L (symmetric case)</p></dd>

<dt>EZ</dt>
<dd><p>estimate of expectation of Z
matrix</p></dd>
 <dt>YPM</dt>
<dd><p>posterior mean of Y (for imputing missing values)</p></dd>

<dt>GOF</dt>
<dd><p>observed (first row) and posterior predictive (remaining rows)
values of four goodness-of-fit statistics</p></dd>

<dt>AIC</dt>
<dd><p>Akaike Information Criterion (if model.name provided)</p></dd>

<dt>BIC</dt>
<dd><p>Bayesian Information Criterion (if model.name provided)</p></dd>

<dt>model.name</dt>
<dd><p>Name of the model (if provided)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This command provides posterior inference for parameters in AME models of
relational data, assuming one of eight possible data types/models.</p>
<p><strong>Theoretical Foundation:</strong></p>
<p>The AME model decomposes network structure into several components:
$$y_{ij} = \beta'x_{ij} + a_i + b_j + u_i'v_j + \epsilon_{ij}$$
where:</p><ul><li><p>\(\beta'x_{ij}\): Fixed effects of dyadic/nodal covariates</p></li>
<li><p>\(a_i\): Additive sender (row) effect for node i</p></li>
<li><p>\(b_j\): Additive receiver (column) effect for node j</p></li>
<li><p>\(u_i'v_j\): Multiplicative interaction between latent factors</p></li>
<li><p>\(\epsilon_{ij}\): Dyadic error term (may be correlated)</p></li>
</ul><p>This specification generalizes the social relations model (Warner et al. 1979)
and latent space models (Hoff et al. 2002) within a unified framework.</p>
<p><strong>Prior Distributions:</strong></p>
<p>The model uses conjugate and semi-conjugate priors where possible:</p><ul><li><p>Regression coefficients: \(\beta \sim N(0, g\sigma^2(X'X)^{-1})\) (g-prior)</p></li>
<li><p>Additive effects: \((a_i, b_i)' \sim N(0, \Sigma_{ab})\) jointly</p></li>
<li><p>Covariance: \(\Sigma_{ab} \sim IW(\eta_0, \eta_0 S_{ab0})\) (inverse-Wishart)</p></li>
<li><p>Multiplicative effects: Hierarchical shrinkage via \(\eta_0\)</p></li>
<li><p>Dyadic correlation: \(\rho \sim Uniform(-1, 1)\) with Metropolis updates</p></li>
</ul><p>The inverse-Wishart prior on \(\Sigma_{ab}\) allows learning correlation between
sender and receiver effects, capturing reciprocity patterns.</p>
<p><strong>Multiplicative Effects (Latent Factors):</strong></p>
<p>When R &gt; 0, the model includes R-dimensional latent factors:</p><ul><li><p>Asymmetric case: \(u_i, v_j \in \mathbb{R}^R\) with \(u_i'v_j\) interaction</p></li>
<li><p>Symmetric case: \(u_i = v_i\) with eigendecomposition \(ULU'\)</p></li>
<li><p>Captures homophily, transitivity, and community structure</p></li>
<li><p>R chosen via model selection or set to 2-3 for visualization</p></li>
</ul><p><strong>Estimation Algorithm:</strong></p>
<p>The model uses a Gibbs sampler with the following updates:</p><ol><li><p>Sample latent Z given parameters (data augmentation for non-normal families)</p></li>
<li><p>Update regression coefficients \(\beta\) via g-prior conjugate update</p></li>
<li><p>Update additive effects (a,b) jointly with \(\beta\)</p></li>
<li><p>Update covariance \(\Sigma_{ab}\) from inverse-Wishart</p></li>
<li><p>Update multiplicative effects U,V via Gibbs or Metropolis-Hastings</p></li>
<li><p>Update dyadic correlation \(\rho\) via Metropolis-Hastings</p></li>
<li><p>Update variance \(\sigma^2\) (for continuous families)</p></li>
</ol><p><strong>Standard Model Types:</strong></p>
<p>The following data types/models are available:</p>
<p>"normal": A normal AME model.</p>
<p>"tobit": A tobit AME model for censored continuous data. Values are censored
at zero, appropriate for non-negative continuous relational data.</p>
<p>"binary": A binary probit AME model.</p>
<p>"ordinal": An ordinal probit AME model. An intercept is not identifiable in this
model.</p>
<p>"cbin": An AME model for censored binary data.  The value of 'odmax'
specifies the maximum number of links each row may have.</p>
<p>"frn": An AME model for fixed rank nomination networks. A higher value of
the rank indicates a stronger relationship. The value of 'odmax' specifies
the maximum number of links each row may have.</p>
<p>"rrl": An AME model based on the row ranks. This is appropriate if the
relationships across rows are not directly comparable in terms of scale. An
intercept, row random effects and row regression effects are not estimable
for this model.</p>
<p>"poisson": An overdispersed Poisson AME model for count data. The latent
variable represents the log mean of the Poisson distribution.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Peter Hoff</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">YX_bin</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">fit</span><span class="op">&lt;-</span><span class="fu">ame</span><span class="op">(</span><span class="va">YX_bin</span><span class="op">$</span><span class="va">Y</span>,<span class="va">YX_bin</span><span class="op">$</span><span class="va">X</span>,burn<span class="op">=</span><span class="fl">10</span>,nscan<span class="op">=</span><span class="fl">10</span>,odens<span class="op">=</span><span class="fl">1</span>,family<span class="op">=</span><span class="st">"binary"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Note: you should run the Markov chain much longer in practice</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># } </span></span></span>
<span class="r-in"><span> </span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Shahryar Minhas, Tosin Salau, Cassy Dorff.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

